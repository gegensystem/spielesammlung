<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brettspiel-Sammlung</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8fafc; /* slate-50 */
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; } /* slate-200 */
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; } /* slate-400 */
        ::-webkit-scrollbar-thumb:hover { background: #64748b; } /* slate-500 */
        
        /* Grid Layout for Games */
        #game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        .card-hover-effect {
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        }
        .card-hover-effect:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
    </style>
</head>
<body class="text-slate-800 p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-10">
            <h1 id="page-title" class="text-4xl sm:text-5xl font-bold text-slate-900">Brettspiel-Sammlung</h1>
            <p id="page-subtitle" class="text-lg text-indigo-600 mt-1">Alle erfassten Spiele</p>
        </header>
        
        <!-- Filter etc. hier, falls benötigt -->

        <!-- Spiele-Grid -->
        <div id="loading-indicator" class="text-center text-xl text-slate-500 p-10">
            <svg class="animate-spin h-8 w-8 text-indigo-500 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Lade Spiele...
        </div>
        <div id="game-grid" class="hidden">
            <!-- Game Cards werden hier per JS eingefügt -->
        </div>
        <div id="no-results" class="hidden text-center p-8 text-slate-500">
            <p class="text-xl">Für diese Ansicht wurden keine Spiele gefunden.</p>
        </div>
    </div>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, query, where, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCPyP46stsxNFXzaiqgKiwdBecihBEg6IE",
            authDomain: "spielesammlung-3f93d.firebaseapp.com",
            projectId: "spielesammlung-3f93d",
            storageBucket: "spielesammlung-3f93d.appspot.com", 
            messagingSenderId: "48428696882",
            appId: "1:48428696882:web:145a5efad401dc9cc7432b",
            measurementId: "G-378SQP6059"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // DOM Elemente
        const gameGrid = document.getElementById('game-grid');
        const loadingIndicator = document.getElementById('loading-indicator');
        const noResults = document.getElementById('no-results');
        const pageTitle = document.getElementById('page-title');
        const pageSubtitle = document.getElementById('page-subtitle');

        // URL-Parameter auslesen für die Ansicht
        const urlParams = new URLSearchParams(window.location.search);
        const view = urlParams.get('view'); // z.B. 'private', 'genduron'

        let gamesQuery;
        const gamesCollection = collection(db, 'games');
        const defaultOrder = orderBy("title");

        // Query basierend auf dem URL-Parameter anpassen
        if (view === 'private') {
            gamesQuery = query(gamesCollection, where("location", "==", "Private Sammlung"), defaultOrder);
            pageTitle.textContent = "Meine private Sammlung";
            pageSubtitle.textContent = "Alle Spiele in meiner privaten Sammlung";
            document.title = "Meine private Sammlung";
        } else if (view === 'genduron') {
            gamesQuery = query(gamesCollection, where("location", "==", "Genduron"), defaultOrder);
            pageTitle.textContent = "Spiele im Genduron";
            pageSubtitle.textContent = "Alle Spiele, die im Genduron gelagert sind";
            document.title = "Spiele im Genduron";
        } else {
            // Standard-Query: alle Spiele anzeigen
            gamesQuery = query(gamesCollection, defaultOrder);
        }

        // Live-Daten von Firestore abrufen
        onSnapshot(gamesQuery, (snapshot) => {
            loadingIndicator.classList.add('hidden');
            gameGrid.innerHTML = ''; // Grid leeren
            
            if (snapshot.empty) {
                noResults.classList.remove('hidden');
                gameGrid.classList.add('hidden');
                return;
            }

            noResults.classList.add('hidden');
            gameGrid.classList.remove('hidden');

            snapshot.docs.forEach(doc => {
                const game = doc.data();
                const gameCard = createGameCard(game);
                gameGrid.appendChild(gameCard);
            });
        }, (error) => {
            console.error("Fehler beim Laden der Spiele:", error);
            loadingIndicator.innerHTML = '<p class="text-red-600">Fehler beim Laden der Spiele.</p>';
        });
        
        function getStatusBadge(status) {
            switch (status) {
                case 'Verfügbar': return 'bg-green-100 text-green-800 ring-1 ring-inset ring-green-600/20';
                case 'Ausgeliehen': return 'bg-yellow-100 text-yellow-800 ring-1 ring-inset ring-yellow-600/20';
                case 'In Prüfung': return 'bg-blue-100 text-blue-800 ring-1 ring-inset ring-blue-600/20';
                case 'Defekt': return 'bg-red-100 text-red-800 ring-1 ring-inset ring-red-600/20';
                default: return 'bg-gray-100 text-gray-800 ring-1 ring-inset ring-gray-600/20';
            }
        }

        function createGameCard(game) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-sm overflow-hidden border border-slate-200 flex flex-col card-hover-effect';

            const placeholderImg = `https://placehold.co/600x400/e2e8f0/475569?text=${encodeURIComponent(game.title)}`;
            
            card.innerHTML = `
                <img src="${game.imageUrl || placeholderImg}" alt="Cover von ${game.title}" class="w-full h-48 object-cover" onerror="this.onerror=null;this.src='${placeholderImg}';">
                <div class="p-5 flex flex-col flex-grow">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-lg font-bold text-slate-900 flex-1 pr-2">${game.title}</h3>
                        <span class="text-xs font-semibold px-2.5 py-0.5 rounded-full ${getStatusBadge(game.status)}">${game.status}</span>
                    </div>
                    <p class="text-sm text-slate-500 mb-4 h-5">${game.genre || ''}</p>
                    
                    <div class="grid grid-cols-3 gap-3 text-center text-sm mb-5">
                        <div>
                            <div class="font-bold text-slate-900 text-base">${game.minPlayers || '?'} - ${game.maxPlayers || '?'}</div>
                            <div class="text-slate-500 text-xs tracking-wider">SPIELER</div>
                        </div>
                        <div>
                            <div class="font-bold text-slate-900 text-base">${game.duration || '?'}</div>
                            <div class="text-slate-500 text-xs tracking-wider">MIN</div>
                        </div>
                        <div>
                            <div class="font-bold text-slate-900 text-base">${game.age || '?'} +</div>
                            <div class="text-slate-500 text-xs tracking-wider">ALTER</div>
                        </div>
                    </div>

                    <div class="mt-auto pt-4 border-t border-slate-200 text-xs text-slate-400">
                        Lagerort: <span class="font-semibold text-slate-600">${game.location || 'Unbekannt'}</span>
                    </div>
                </div>
            `;
            return card;
        }

    </script>
</body>
</html>


